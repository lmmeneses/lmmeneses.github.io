<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Verificador — Ley de Nicole Fenton | Evaluación UX Writing (Registraduría)</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<style>
  :root{
    --bg: #f4f6fb;
    --card: #ffffff;
    --primary: #0b3d91;
    --accent: #0ea5a4;
    --danger: #dc2626;
    --muted: #6b7280;
    --shadow: 0 12px 30px rgba(6,24,44,0.08);
    --glass: rgba(255,255,255,0.8);
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: Inter, "Segoe UI", Roboto, system-ui, -apple-system, "Helvetica Neue", Arial;
    background: linear-gradient(180deg,#eaf2ff 0%, #f4f6fb 100%);
    color:#072034;
    -webkit-font-smoothing:antialiased;
    -moz-osx-font-smoothing:grayscale;
    padding:20px;
  }

  .app {
    max-width:1200px;
    margin:0 auto;
    background:var(--card);
    border-radius:12px;
    overflow:hidden;
    box-shadow:var(--shadow);
    display:flex;
    flex-direction:column;
    min-height:80vh;
  }

  header{
    background:linear-gradient(90deg,var(--primary), #08306b);
    color:white;
    padding:22px 26px;
  }
  header .title {
    display:flex;
    gap:12px;
    align-items:center;
    font-weight:700;
    font-size:1.25rem;
  }
  header p.subtitle{
    margin-top:8px;
    margin-bottom:0;
    opacity:0.95;
    font-weight:500;
    font-size:0.95rem;
  }
  .site-link {
    margin-top:10px;
    display:inline-block;
    background: rgba(255,255,255,0.08);
    padding:6px 10px;
    border-radius:8px;
    font-size:0.9rem;
  }
  .site-link a { color: #fff; text-decoration:underline; }

  /* Tabs */
  .tabs {
    display:flex;
    gap:6px;
    padding:12px;
    background: #f8fafc;
    border-bottom:1px solid #e6eefc;
    flex-wrap:wrap;
  }
  .tab {
    padding:10px 14px;
    border-radius:8px;
    background:transparent;
    cursor:pointer;
    font-weight:600;
    color:var(--muted);
    border:1px solid transparent;
  }
  .tab.active {
    background:linear-gradient(180deg,#fff,#f1f7ff);
    color:var(--primary);
    border-color:#dde9ff;
    box-shadow:0 6px 18px rgba(11,61,145,0.06);
  }

  main.content {
    padding:20px;
    display:flex;
    gap:20px;
    align-items:flex-start;
    flex-wrap:wrap;
  }

  .left {
    flex:1 1 720px;
    min-width:300px;
  }
  .right {
    width:320px;
    min-width:260px;
  }

  .panel {
    background:var(--glass);
    border-radius:10px;
    padding:16px;
    box-shadow:0 6px 20px rgba(8,30,60,0.04);
    border:1px solid rgba(7,32,52,0.04);
  }

  .category-title {
    display:flex; align-items:center; gap:10px; margin-bottom:12px;
    font-weight:700; color:var(--primary);
  }
  .category-title i { color:var(--accent); }

  .grid {
    display:grid;
    grid-template-columns:repeat(auto-fit,minmax(280px,1fr));
    gap:16px;
    margin-bottom:6px;
  }

  .checklist {
    display:flex; flex-direction:column; gap:10px;
  }

  .item {
    display:flex; gap:12px; align-items:flex-start; background:#fff;
    padding:12px; border-radius:8px; border:1px solid rgba(7,32,52,0.04);
  }
  .item input[type="checkbox"]{ transform:scale(1.25); margin-top:4px; }
  .item .meta { flex:1 }
  .item label { font-weight:600; display:block; cursor:pointer; }
  .item .note { font-size:0.9rem; color:var(--muted); margin-top:6px; }
  .score-badge {
    background:var(--primary); color:#fff; padding:6px 10px; border-radius:12px;
    font-weight:700; font-size:0.85rem; margin-left:8px; min-width:46px; text-align:center;
  }

  /* Right column */
  .status-box { display:flex; flex-direction:column; gap:12px }
  .progress {
    background:#fff; padding:12px; border-radius:10px; display:flex; flex-direction:column; gap:8px;
  }
  .progress .meta { display:flex; justify-content:space-between; font-weight:700; color:var(--muted); }
  .bar {
    width:100%; height:18px; background:#eef3ff; border-radius:10px; overflow:hidden;
  }
  .bar-fill {
    height:100%; width:0%; background:linear-gradient(90deg,var(--accent), #06b6d4); display:flex;
    align-items:center; justify-content:flex-end; padding-right:8px; color:#fff; font-weight:700;
    transition:width 0.55s ease;
  }

  .scores {
    display:grid; grid-template-columns:1fr 1fr; gap:10px;
  }
  .score-card { background:#fff; padding:12px; border-radius:8px; text-align:center; }
  .score-card .value { font-size:1.75rem; font-weight:800; color:var(--primary); }
  .score-card .label { color:var(--muted); font-weight:700; font-size:0.9rem; }

  .actions { display:flex; gap:8px; margin-top:6px; }
  button { border:none; padding:10px 12px; border-radius:8px; font-weight:700; cursor:pointer; }
  .btn-save { background:var(--primary); color:#fff; }
  .btn-reset { background:#e6eefc; color:var(--primary); border:1px solid rgba(11,61,145,0.06); }
  .recommendations { background:#fff; padding:12px; border-radius:8px; min-height:120px; }

  footer {
    padding:14px 20px; text-align:center; font-size:0.9rem; color:var(--muted);
    border-top:1px solid rgba(7,32,52,0.03); background:transparent;
  }

  @media (max-width:980px){
    main.content { flex-direction:column; }
    .right { width:100%; }
  }

</style>
</head>
<body>
  <div class="app" role="application" aria-label="Verificador Ley de Nicole Fenton — Evaluación UX Writing">
    <header>
      <div class="title">
        <i class="fas fa-balance-scale"></i>
        <div>
          Verificador — Ley de Nicole Fenton
          <div style="font-size:0.85rem; font-weight:600; opacity:0.95">Evaluación formal y judicial de UX Writing — sitio: Registraduría</div>
        </div>
      </div>
      <p class="subtitle">Lista de chequeo exhaustiva para revisar claridad, concisión, formalidad, consistencia, jerarquía, accesibilidad y microcopy (según Nicole Fenton).</p>
      <div class="site-link">
        Sitio evaluado: <a href="https://www.registraduria.gov.co/" target="_blank" rel="noopener noreferrer">https://www.registraduria.gov.co/</a>
      </div>
    </header>

    <div class="tabs" role="tablist" aria-label="Secciones de la lista de chequeo">
      <div class="tab active" data-tab="claridad" role="tab" aria-selected="true">Claridad & Comprensión</div>
      <div class="tab" data-tab="consistencia" role="tab">Consistencia</div>
      <div class="tab" data-tab="jerarquia" role="tab">Jerarquía & Escaneabilidad</div>
      <div class="tab" data-tab="orientacion" role="tab">Orientación al Usuario</div>
      <div class="tab" data-tab="accesibilidad" role="tab">Accesibilidad</div>
      <div class="tab" data-tab="microcopy" role="tab">Microcopy Efectivo</div>
      <div class="tab" data-tab="resultados" role="tab">Resultados</div>
    </div>

    <main class="content" role="main">
      <section class="left" aria-live="polite">
        <!-- CLARIDAD -->
        <div id="claridad" class="panel tab-panel">
          <div class="category-title"><i class="fas fa-eye"></i> Claridad y Comprensión</div>
          <div class="checklist" aria-label="Items de claridad">
            <div class="item">
              <input type="checkbox" id="cl-1" data-score="6" />
              <div class="meta">
                <label for="cl-1">El lenguaje evita ambigüedades y es preciso.</label>
                <div class="note">Frases concretas; sin dobles interpretaciones.</div>
              </div>
              <div class="score-badge">6</div>
            </div>

            <div class="item">
              <input type="checkbox" id="cl-2" data-score="5" />
              <div class="meta">
                <label for="cl-2">Los títulos y subtítulos describen con exactitud el contenido.</label>
                <div class="note">El usuario entiende la sección solo con el título.</div>
              </div>
              <div class="score-badge">5</div>
            </div>

            <div class="item">
              <input type="checkbox" id="cl-3" data-score="5" />
              <div class="meta">
                <label for="cl-3">No hay jerga técnica innecesaria; si existe, se explica.</label>
                <div class="note">Si se usan términos técnicos, se define con claridad.</div>
              </div>
              <div class="score-badge">5</div>
            </div>

            <div class="item">
              <input type="checkbox" id="cl-4" data-score="4" />
              <div class="meta">
                <label for="cl-4">Las oraciones son concisas y directas (preferencia: < 20 palabras).</label>
                <div class="note">El contenido evita embudos discursivos y rodeos.</div>
              </div>
              <div class="score-badge">4</div>
            </div>

            <div class="item">
              <input type="checkbox" id="cl-5" data-score="4" />
              <div class="meta">
                <label for="cl-5">Los ejemplos y aclaraciones facilitan la comprensión cuando aplica.</label>
                <div class="note">Ejemplos útiles y aplicables al contexto del usuario.</div>
              </div>
              <div class="score-badge">4</div>
            </div>
          </div>
        </div>

        <!-- CONSISTENCIA -->
        <div id="consistencia" class="panel tab-panel" style="display:none">
          <div class="category-title"><i class="fas fa-sync-alt"></i> Consistencia</div>
          <div class="checklist" aria-label="Items de consistencia">
            <div class="item">
              <input type="checkbox" id="co-1" data-score="5" />
              <div class="meta">
                <label for="co-1">Terminología reiterada de forma coherente en todo el sitio.</label>
                <div class="note">Mismo término para la misma acción/objeto.</div>
              </div>
              <div class="score-badge">5</div>
            </div>
            <div class="item">
              <input type="checkbox" id="co-2" data-score="4" />
              <div class="meta">
                <label for="co-2">Tono y voz consistentes (no cambia de formal a coloquial sin justificación).</label>
                <div class="note">La voz institucional es estable y reconocible.</div>
              </div>
              <div class="score-badge">4</div>
            </div>
            <div class="item">
              <input type="checkbox" id="co-3" data-score="4" />
              <div class="meta">
                <label for="co-3">Patrones de interacción (botones, alertas) son homogéneos.</label>
                <div class="note">Botones similares usan el mismo verbo y estilo.</div>
              </div>
              <div class="score-badge">4</div>
            </div>
            <div class="item">
              <input type="checkbox" id="co-4" data-score="3" />
              <div class="meta">
                <label for="co-4">Formato de fechas, nombres y direcciones consistente y explícito.</label>
                <div class="note">Ej.: dd/mm/aaaa o dd de mm de aaaa definido y aplicado.</div>
              </div>
              <div class="score-badge">3</div>
            </div>
            <div class="item">
              <input type="checkbox" id="co-5" data-score="3" />
              <div class="meta">
                <label for="co-5">Terminología legal/institucional respetada y actualizada.</label>
                <div class="note">Uso correcto de términos legales propios de Registraduría.</div>
              </div>
              <div class="score-badge">3</div>
            </div>
          </div>
        </div>

        <!-- JERARQUIA -->
        <div id="jerarquia" class="panel tab-panel" style="display:none">
          <div class="category-title"><i class="fas fa-stream"></i> Jerarquía & Escaneabilidad</div>
          <div class="checklist" aria-label="Items de jerarquía">
            <div class="item">
              <input type="checkbox" id="je-1" data-score="5" />
              <div class="meta">
                <label for="je-1">Información priorizada: lo esencial primero.</label>
                <div class="note">El contenido crítico es visible sin desplazamiento excesivo.</div>
              </div>
              <div class="score-badge">5</div>
            </div>
            <div class="item">
              <input type="checkbox" id="je-2" data-score="4" />
              <div class="meta">
                <label for="je-2">Títulos, subtítulos y cuerpos claramente diferenciados.</label>
                <div class="note">Jerarquía visual consistente (H1, H2, H3 o equivalente).</div>
              </div>
              <div class="score-badge">4</div>
            </div>
            <div class="item">
              <input type="checkbox" id="je-3" data-score="4" />
              <div class="meta">
                <label for="je-3">Uso efectivo de listas, tablas y elementos de apoyo para escanear.</label>
                <div class="note">Listas puntuales en lugar de párrafos largos.</div>
              </div>
              <div class="score-badge">4</div>
            </div>
            <div class="item">
              <input type="checkbox" id="je-4" data-score="3" />
              <div class="meta">
                <label for="je-4">Espaciado y agrupación que guían la lectura.</label>
                <div class="note">Bloques visuales separados por función.</div>
              </div>
              <div class="score-badge">3</div>
            </div>
            <div class="item">
              <input type="checkbox" id="je-5" data-score="3" />
              <div class="meta">
                <label for="je-5">Acciones (CTA) destacadas y visibles en contexto.</label>
                <div class="note">Los botones más importantes contrastan apropiadamente.</div>
              </div>
              <div class="score-badge">3</div>
            </div>
          </div>
        </div>

        <!-- ORIENTACION -->
        <div id="orientacion" class="panel tab-panel" style="display:none">
          <div class="category-title"><i class="fas fa-user-check"></i> Orientación al Usuario</div>
          <div class="checklist" aria-label="Items de orientación">
            <div class="item">
              <input type="checkbox" id="or-1" data-score="6" />
              <div class="meta">
                <label for="or-1">El lenguaje se dirige al usuario (beneficios y acciones claras).</label>
                <div class="note">Enfoque en “qué gana/qué debe hacer el usuario”.</div>
              </div>
              <div class="score-badge">6</div>
            </div>
            <div class="item">
              <input type="checkbox" id="or-2" data-score="4" />
              <div class="meta">
                <label for="or-2">Mensajes de error indican la causa y la acción siguiente.</label>
                <div class="note">Errores útiles, no sólo códigos o mensajes genéricos.</div>
              </div>
              <div class="score-badge">4</div>
            </div>
            <div class="item">
              <input type="checkbox" id="or-3" data-score="4" />
              <div class="meta">
                <label for="or-3">Guías paso a paso cuando se requiere completar procesos.</label>
                <div class="note">Secuencia clara y señalizada en procesos (registro, solicitudes).</div>
              </div>
              <div class="score-badge">4</div>
            </div>
            <div class="item">
              <input type="checkbox" id="or-4" data-score="3" />
              <div class="meta">
                <label for="or-4">Lenguaje que reduce ansiedad: transparencia sobre tiempos y requisitos.</label>
                <div class="note">Indicaciones sobre duración, documentos requeridos, etc.</div>
              </div>
              <div class="score-badge">3</div>
            </div>
            <div class="item">
              <input type="checkbox" id="or-5" data-score="3" />
              <div class="meta">
                <label for="or-5">Opciones de contacto o ayuda claramente visibles.</label>
                <div class="note">Soporte accesible (teléfono, chat, FAQs) en contexto.</div>
              </div>
              <div class="score-badge">3</div>
            </div>
          </div>
        </div>

        <!-- ACCESIBILIDAD -->
        <div id="accesibilidad" class="panel tab-panel" style="display:none">
          <div class="category-title"><i class="fas fa-universal-access"></i> Accesibilidad</div>
          <div class="checklist" aria-label="Items de accesibilidad">
            <div class="item">
              <input type="checkbox" id="ac-1" data-score="5" />
              <div class="meta">
                <label for="ac-1">Contraste de texto cumple con WCAG (texto normal y grande).</label>
                <div class="note">Comprobable con herramientas; contraste suficiente.</div>
              </div>
              <div class="score-badge">5</div>
            </div>
            <div class="item">
              <input type="checkbox" id="ac-2" data-score="4" />
              <div class="meta">
                <label for="ac-2">Textos alternativos en imágenes informativos y presentes.</label>
                <div class="note">Alt descriptivo que comunica la función de la imagen.</div>
              </div>
              <div class="score-badge">4</div>
            </div>
            <div class="item">
              <input type="checkbox" id="ac-3" data-score="4" />
              <div class="meta">
                <label for="ac-3">Contenido compatible con lectores de pantalla (orden lógico).</label>
                <div class="note">Lectura coherente para usuarios con ayudas técnicas.</div>
              </div>
              <div class="score-badge">4</div>
            </div>
            <div class="item">
              <input type="checkbox" id="ac-4" data-score="3" />
              <div class="meta">
                <label for="ac-4">Formularios accesibles: etiquetas claras y foco visible.</label>
                <div class="note">Inputs etiquetados y guía de error audible/visual.</div>
              </div>
              <div class="score-badge">3</div>
            </div>
            <div class="item">
              <input type="checkbox" id="ac-5" data-score="3" />
              <div class="meta">
                <label for="ac-5">Lenguaje inclusivo y no discriminatorio en todo el sitio.</label>
                <div class="note">Textos que respetan diversidad y neutralidad.</div>
              </div>
              <div class="score-badge">3</div>
            </div>
          </div>
        </div>

        <!-- MICROCOPY -->
        <div id="microcopy" class="panel tab-panel" style="display:none">
          <div class="category-title"><i class="fas fa-comment-dots"></i> Microcopy Efectivo</div>
          <div class="checklist" aria-label="Items de microcopy">
            <div class="item">
              <input type="checkbox" id="mi-1" data-score="5" />
              <div class="meta">
                <label for="mi-1">CTA claros y orientados a la acción (verbos específicos).</label>
                <div class="note">Ej.: "Solicitar cita" en lugar de "Enviar".</div>
              </div>
              <div class="score-badge">5</div>
            </div>
            <div class="item">
              <input type="checkbox" id="mi-2" data-score="4" />
              <div class="meta">
                <label for="mi-2">Placeholders y etiquetas guían sin sustituir la etiqueta.</label>
                <div class="note">Label persistente + ejemplo en placeholder si aplica.</div>
              </div>
              <div class="score-badge">4</div>
            </div>
            <div class="item">
              <input type="checkbox" id="mi-3" data-score="5" />
              <div class="meta">
                <label for="mi-3">Mensajes de confirmación claros y afirmativos.</label>
                <div class="note">Confirman resultado y pasos siguientes (si aplica).</div>
              </div>
              <div class="score-badge">5</div>
            </div>
            <div class="item">
              <input type="checkbox" id="mi-4" data-score="4" />
              <div class="meta">
                <label for="mi-4">Microcopy contextual (tooltips/ayudas) disponibles y precisos.</label>
                <div class="note">Ayudan sin saturar la interfaz.</div>
              </div>
              <div class="score-badge">4</div>
            </div>
            <div class="item">
              <input type="checkbox" id="mi-5" data-score="3" />
              <div class="meta">
                <label for="mi-5">Mensajes de error ofrecen solución, no sólo diagnóstico.</label>
                <div class="note">Indican la acción a tomar y, cuando corresponda, contacto.</div>
              </div>
              <div class="score-badge">3</div>
            </div>
          </div>
        </div>

        <!-- RESULTADOS detallados (solo visualización por panel largo si quieren) -->
        <div id="resultados" class="panel tab-panel" style="display:none">
          <div class="category-title"><i class="fas fa-chart-simple"></i> Resultados detallados de la evaluación</div>
          <div style="display:flex; gap:12px; flex-wrap:wrap;">
            <div style="flex:1; min-width:220px" class="panel">
              <div style="font-weight:800; color:var(--muted)">Resumen ejecutivo</div>
              <div style="margin-top:8px; color:var(--muted); font-size:0.95rem">
                La puntuación refleja cumplimiento frente a criterios de Nicole Fenton: claridad, concisión y orientación al usuario, trasladados a seis categorías. Use las recomendaciones para priorizar correcciones formales y de contenido.
              </div>
            </div>
            <div style="width:240px" class="panel">
              <div style="font-weight:800; color:var(--muted)">Enlace auditado</div>
              <div style="margin-top:8px; font-size:0.95rem"><a href="https://www.registraduria.gov.co/" target="_blank" rel="noopener">https://www.registraduria.gov.co/</a></div>
            </div>
          </div>
        </div>

      </section>

      <!-- RIGHT COLUMN: progreso y puntuaciones -->
      <aside class="right">
        <div class="panel status-box" aria-hidden="false">
          <div class="progress" aria-label="Progreso general">
            <div class="meta"><span>Progreso general</span><span id="progressPct">0%</span></div>
            <div class="bar" role="progressbar" aria-valuemin="0" aria-valuemax="100" aria-valuenow="0">
              <div class="bar-fill" id="barFill">0%</div>
            </div>
          </div>

          <div class="scores">
            <div class="score-card" aria-live="polite">
              <div class="value" id="score-claridad">0</div>
              <div class="label">Claridad</div>
            </div>
            <div class="score-card">
              <div class="value" id="score-consistencia">0</div>
              <div class="label">Consistencia</div>
            </div>
            <div class="score-card">
              <div class="value" id="score-jerarquia">0</div>
              <div class="label">Jerarquía</div>
            </div>
            <div class="score-card">
              <div class="value" id="score-orientacion">0</div>
              <div class="label">Orientación</div>
            </div>
            <div class="score-card">
              <div class="value" id="score-accesibilidad">0</div>
              <div class="label">Accesibilidad</div>
            </div>
            <div class="score-card">
              <div class="value" id="score-microcopy">0</div>
              <div class="label">Microcopy</div>
            </div>
          </div>

          <div style="display:flex; gap:8px; margin-top:8px; align-items:center;">
            <div style="flex:1;">
              <div style="font-weight:800; color:var(--muted)">Total</div>
              <div style="font-size:1.5rem; font-weight:800; color:var(--primary)" id="score-total">0</div>
              <div style="color:var(--muted); font-size:0.85rem">Puntos máximos: <span id="max-total">0</span></div>
            </div>
            <div style="width:120px">
              <div style="font-weight:700; color:var(--muted)">Acciones</div>
              <div class="actions" role="group" aria-label="Acciones">
                <button class="btn-save" id="btnSave"><i class="fas fa-save"></i>&nbsp;Guardar</button>
                <button class="btn-reset" id="btnReset"><i class="fas fa-rotate-right"></i>&nbsp;Reiniciar</button>
              </div>
            </div>
          </div>

          <div class="recommendations" id="reco" aria-live="polite">
            <strong>Recomendaciones:</strong>
            <ul id="recoList" style="margin-top:8px; color:var(--muted)"><li>Complete la evaluación para recibir recomendaciones formales y priorizadas.</li></ul>
          </div>
        </div>
      </aside>
    </main>

    <footer>
      Evaluador formal basado en principios de Nicole Fenton — diseñado para auditoría de contenidos institucionales (Registraduría). Guardado local en este dispositivo.
    </footer>
  </div>

<script>
/*
  Script funcional:
  - Detecta todas las casillas y suma puntajes por categoría (prefijos: cl-, co-, je-, or-, ac-, mi-)
  - Calcula máximos dinámicamente (en caso de editar items)
  - Actualiza barra de progreso, puntajes, recomendaciones
  - Guarda/recupera estado en localStorage: key -> "fentonRegistrarChecklist_v1"
  - Interfaz de pestañas
*/

document.addEventListener('DOMContentLoaded', () => {
  const TAB_SELECTOR = '.tab';
  const tabs = document.querySelectorAll(TAB_SELECTOR);
  const panels = document.querySelectorAll('.tab-panel');
  const checkboxSelector = 'input[type="checkbox"][data-score]';
  const checkboxes = Array.from(document.querySelectorAll(checkboxSelector));

  // UI nodes
  const barFill = document.getElementById('barFill');
  const progressPct = document.getElementById('progressPct');
  const scoreClar = document.getElementById('score-claridad');
  const scoreCons = document.getElementById('score-consistencia');
  const scoreJer = document.getElementById('score-jerarquia');
  const scoreOri = document.getElementById('score-orientacion');
  const scoreAcc = document.getElementById('score-accesibilidad');
  const scoreMic = document.getElementById('score-microcopy');
  const scoreTotalEl = document.getElementById('score-total');
  const maxTotalEl = document.getElementById('max-total');
  const recoList = document.getElementById('recoList');
  const saveBtn = document.getElementById('btnSave');
  const resetBtn = document.getElementById('btnReset');

  // prefixes and mapping
  const prefixes = {
    'cl-': {el: scoreClar, score:0, max:0, label:'Claridad'},
    'co-': {el: scoreCons, score:0, max:0, label:'Consistencia'},
    'je-': {el: scoreJer, score:0, max:0, label:'Jerarquía'},
    'or-': {el: scoreOri, score:0, max:0, label:'Orientación'},
    'ac-': {el: scoreAcc, score:0, max:0, label:'Accesibilidad'},
    'mi-': {el: scoreMic, score:0, max:0, label:'Microcopy'}
  };

  const STORAGE_KEY = 'fentonRegistrarChecklist_v1';

  // Calculate dynamic maximums (sum of data-score for each prefix)
  function computeMaximums() {
    // reset
    Object.keys(prefixes).forEach(k => { prefixes[k].max = 0; prefixes[k].score = 0; prefixes[k].el.textContent = '0'; });
    checkboxes.forEach(cb => {
      const score = Number(cb.dataset.score) || 0;
      for (const pre of Object.keys(prefixes)) {
        if (cb.id.startsWith(pre)) {
          prefixes[pre].max += score;
        }
      }
    });
    // set max total
    const maxTotal = Object.values(prefixes).reduce((s,p) => s + p.max, 0);
    maxTotalEl.textContent = maxTotal;
    return maxTotal;
  }

  // Update UI: compute scores, progress, recommendations
  function updateUI(saveAfter=true) {
    // reset scores
    Object.keys(prefixes).forEach(k => { prefixes[k].score = 0; });

    let checkedCount = 0;
    checkboxes.forEach(cb => {
      if (cb.checked) {
        checkedCount++;
        const score = Number(cb.dataset.score) || 0;
        for (const pre of Object.keys(prefixes)) {
          if (cb.id.startsWith(pre)) {
            prefixes[pre].score += score;
          }
        }
      }
    });

    // compute per-category and total
    const totalScore = Object.values(prefixes).reduce((s,p) => s + p.score, 0);
    const maxTotal = Number(maxTotalEl.textContent) || computeMaximums();

    // update per-category displays
    Object.keys(prefixes).forEach(k => {
      prefixes[k].el.textContent = prefixes[k].score + ' / ' + prefixes[k].max;
    });

    // update total display
    scoreTotalEl.textContent = totalScore;

    // progress as percentage of checked items over total items (not score-based)
    const pct = Math.round((checkedCount / checkboxes.length) * 100);
    progressPct.textContent = pct + '%';
    barFill.style.width = pct + '%';
    barFill.textContent = pct + '%';
    barFill.setAttribute('aria-valuenow', pct);

    // color logic for bar (progress)
    if (pct < 30) {
      barFill.style.background = 'linear-gradient(90deg,#ef4444,#dc2626)';
    } else if (pct < 70) {
      barFill.style.background = 'linear-gradient(90deg,#f59e0b,#f97316)';
    } else {
      barFill.style.background = 'linear-gradient(90deg,#06b6d4,#06b6d4)';
    }

    // update small cards (extract only numeric value before slash if present)
    scoreClar.textContent = prefixes['cl-'].score;
    scoreCons.textContent = prefixes['co-'].score;
    scoreJer.textContent = prefixes['je-'].score;
    scoreOri.textContent = prefixes['or-'].score;
    scoreAcc.textContent = prefixes['ac-'].score;
    scoreMic.textContent = prefixes['mi-'].score;

    // recommendations (formal judicial tone, actionable)
    updateRecommendations(prefixes, totalScore, maxTotal);

    if (saveAfter) saveProgress();
  }

  // Build recommendations: formal, conciso y con prioridad
  function updateRecommendations(prefixData, totalScore, maxTotal) {
    // produce prioritized list
    const recs = [];
    // if nothing checked
    if (totalScore === 0) {
      recs.push('No se ha marcado ningún criterio. Inicie la evaluación para recibir recomendaciones priorizadas.');
    } else {
      // For each category compute percent
      const categories = Object.entries(prefixData).map(([k,v]) => {
        const pct = v.max ? Math.round((v.score / v.max) * 100) : 0;
        return { key: k, pct: pct, label: v.label || k, score: v.score, max: v.max };
      });

      // sort by lowest pct (need attention)
      categories.sort((a,b) => a.pct - b.pct);

      recs.push('Informe ejecutivo: puntuación total ' + totalScore + ' de ' + maxTotal + '.');
      recs.push('Priorice correcciones por orden crítico (peor desempeño primero):');

      categories.forEach(cat => {
        if (cat.max === 0) return;
        let advice = '';
        if (cat.pct >= 85) {
          advice = 'Cumplimiento alto. Mantener buenas prácticas.';
        } else if (cat.pct >= 60) {
          advice = 'Cumplimiento razonable. Revisar elementos no marcados y estandarizar lenguaje.';
        } else if (cat.pct >= 35) {
          advice = 'Cumplimiento insuficiente. Reescribir textos prioritarios y mejorar microcopy.';
        } else {
          advice = 'Deficiencia crítica. Revisión urgente de contenidos y experiencia de usuario.';
        }
        recs.push(cat.label + ' — ' + cat.score + '/' + cat.max + ' (' + cat.pct + '%): ' + advice);
      });

      // actionable judicial-style recommendations
      recs.push('Recomendaciones operativas (ordenadas):');
      recs.push('1) Revisar todos los títulos y subtítulos: deben describir el resultado que el usuario obtendrá.');
      recs.push('2) Establecer un glosario institucional para términos técnicos y legales usados por la Registraduría.');
      recs.push('3) Normalizar CTAs y mensajes de error: verbos directos y pasos siguientes claros.');
      recs.push('4) Priorizar accesibilidad: contraste y alt text en imágenes de contenido informativo.');
      recs.push('5) Implementar revisiones periódicas de microcopy con responsables editoriales claros.');
    }

    // render as list
    recoList.innerHTML = '';
    recs.forEach(r => {
      const li = document.createElement('li');
      li.style.marginBottom = '6px';
      li.style.color = '#334155';
      li.textContent = r;
      recoList.appendChild(li);
    });
  }

  // Save / Load localStorage
  function saveProgress() {
    const state = {};
    checkboxes.forEach(cb => state[cb.id] = !!cb.checked);
    try {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
      // optional visual feedback (temporarily)
      saveBtn.textContent = 'Guardado ✓';
      setTimeout(()=> saveBtn.innerHTML = '<i class="fas fa-save"></i>&nbsp;Guardar', 900);
    } catch (e) {
      console.warn('No se pudo guardar localmente:', e);
    }
  }

  function loadProgress() {
    const raw = localStorage.getItem(STORAGE_KEY);
    if (!raw) return;
    try {
      const state = JSON.parse(raw);
      checkboxes.forEach(cb => {
        if (state.hasOwnProperty(cb.id)) cb.checked = !!state[cb.id];
      });
    } catch (e) {
      console.warn('Estado corrupto', e);
    }
  }

  // Reset all
  function resetAll() {
    if (!confirm('¿Confirma reiniciar toda la evaluación? Esta acción restablece las marcas actuales.')) return;
    checkboxes.forEach(cb => cb.checked = false);
    saveProgress();
    updateUI(false);
  }

  // Setup event listeners for checkboxes
  checkboxes.forEach(cb => cb.addEventListener('change', () => updateUI(true)));

  // Setup tab switching
  tabs.forEach(t => {
    t.addEventListener('click', () => {
      tabs.forEach(x => x.classList.remove('active'));
      t.classList.add('active');
      // hide all panels
      panels.forEach(p => p.style.display = 'none');
      // show target
      const id = t.getAttribute('data-tab');
      const panel = document.getElementById(id);
      if (panel) panel.style.display = 'block';
      // small accessibility: focus first focusable control
      const firstFocusable = panel && panel.querySelector('input, button, a');
      if (firstFocusable) firstFocusable.focus();
    });
  });

  // Attach actions
  saveBtn.addEventListener('click', () => saveProgress());
  resetBtn.addEventListener('click', () => resetAll());

  // initial compute maximums and load
  const maxTotal = computeMaximums();
  loadProgress();
  updateUI(false);

  // expose for debugging (optional)
  window._fenton = { prefixes, updateUI, computeMaximums };

});
</script>
</body>
</html>
